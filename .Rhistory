sp <- sp%>%
mutate(season = ifelse(CalendarMonth %in% c('03','04','05'), 'Spring',
ifelse(CalendarMonth %in% c('06','07','08'), 'Summer',
ifelse(CalendarMonth %in% c('09','10','11'), 'Fall',
ifelse(CalendarMonth %in% c('12','01','02'), 'Winter','0')))))%>%
filter(season != '0')
wa <- wa%>%
mutate(season = ifelse(CalendarMonth %in% c('3','4','5'), 'Spring',
ifelse(CalendarMonth %in% c('6','7','8'), 'Summer',
ifelse(CalendarMonth %in% c('9','10','11'), 'Fall',
ifelse(CalendarMonth %in% c('12','1','2'), 'Winter','0')))))%>%
filter(season != '0')
sd <- sd%>%
mutate(season = ifelse(CalendarMonth %in% c('03','04','05'), 'Spring',
ifelse(CalendarMonth %in% c('06','07','08'), 'Summer',
ifelse(CalendarMonth %in% c('09','10','11'), 'Fall',
ifelse(CalendarMonth %in% c('12','01','02'), 'Winter','0')))))%>%
filter(season != '0')
sp <- sp%>%
mutate(season = ifelse(CalendarMonth %in% c('03','04','05'), 'Spring',
ifelse(CalendarMonth %in% c('06','07','08'), 'Summer',
ifelse(CalendarMonth %in% c('09','10','11'), 'Fall',
ifelse(CalendarMonth %in% c('12','01','02'), 'Winter','0')))))%>%
filter(season != '0')
wa <- wa%>%
mutate(season = ifelse(CalendarMonth %in% c('3','4','5'), 'Spring',
ifelse(CalendarMonth %in% c('6','7','8'), 'Summer',
ifelse(CalendarMonth %in% c('9','10','11'), 'Fall',
ifelse(CalendarMonth %in% c('12','1','2'), 'Winter','0')))))%>%
filter(season != '0')
ggplot(sd,aes(hourly_demand))+
geom_histogram()+
theme_minimal()+
facet_wrap(~season)
ggplot(sd,aes(hourly_demand))+
geom_histogram()+
theme_minimal()+
facet_wrap(~CalendarYear)
sd%>%
group_by(CalendarYear)%>%
summarise(mean(hourly_demand))%>%
rename(avg_demand = 'mean(hourly_demand)')%>%
ggplot(aes(CalendarYear, avg_demand))+
geom_col()+
theme_minimal()
sd%>%
group_by(CalendarYear)%>%
summarise(sum(hourly_demand))%>%
rename(avg_demand = 'sum(hourly_demand)')%>%
ggplot(aes(CalendarYear, avg_demand))+
geom_col()+
theme_minimal()
sd%>%
group_by(CalendarYear)%>%
summarise(sum(hourly_demand))%>%
rename(Sum_of_demand = 'sum(hourly_demand)')%>%
ggplot(aes(CalendarYear, Sum_of_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(mean(well_flow_cfs))%>%
rename(avg_demand = 'mean(well_flow_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(mean(purchased_flow_cfs))%>%
rename(avg_demand = 'mean(purchased_flow_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(mean(transported_flow_cfs))%>%
rename(avg_demand = 'mean(transported_flow_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(mean(treated_flow_cfs))%>%
rename(avg_demand = 'mean(treated_flow_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(mean(injected_flow_cfs))%>%
rename(avg_demand = 'mean(injected_flow_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(mean(reservoir_trend_cfs))%>%
rename(avg_demand = 'mean(reservoir_trend_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(sum(reservoir_trend_cfs))%>%
rename(avg_demand = 'sum(reservoir_trend_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
knitr::opts_chunk$set(echo = TRUE)
list.of.packages <- c("tidyverse", "lubridate","chron","knitr")
new.packages <- list.of.packages[!(list.of.packages %in% installed.packages()[,"Package"])]
if(length(new.packages)) install.packages(new.packages)
library(tidyverse)
library(lubridate)
library(chron)
library(knitr)
#read in data. Change names to be more readable and make hourly demand numeric
sd <- read.csv("2_year_system_demand.csv")%>%
rename('hourly_demand' = 'Hourly.Demand..cfs.',
'date_time' = 'Read.Date.Time')%>%
mutate(hourly_demand = as.numeric(hourly_demand),
hourly_demand = ifelse(is.na(hourly_demand),0,hourly_demand)) #What do we do with NA's???
#Make Date and Time match a consistent format with the Weather Data
sd2 <- as.data.frame(str_split_fixed(sd$date_time, " ", 3))%>%
rename(date = V1, time = V2, am_or_pm = V3)%>%
mutate(datetime_str = paste(date, time, am_or_pm),
datetime = as.POSIXct(strptime(datetime_str, format = "%m/%d/%y %I:%M %p")),
datetime_military = strftime(datetime, format = "%m/%d/%Y %H:%M")) %>%
select(datetime,datetime_military)
sd3 <-as.data.frame(str_split_fixed(sd2$datetime_military, " ", 2))%>%
rename(date = V1, time = V2)
sd4 <-as.data.frame(str_split_fixed(sd3$date, "/", 3))%>%
rename(CalendarMonth = V1,  CalendarDay = V2, CalendarYear = V3)
#Throw it all together
sd <- cbind(sd,sd2,sd3,sd4)%>%
select(-date_time)
#Get rid of temp dfs
remove(sd2,sd3,sd4)
#The names and dates in this table do not need much conversion
wa <- read.csv("weather_sl_airport.csv")
sp <- read.csv("system_demand_by_point_type.csv")%>%
rename('date_time' = 'Read.Date.Time',
'well_flow_cfs' = 'Well.Flow..cfs.',
'purchased_flow_cfs' = 'Purchased.Flow..cfs.',
'transported_flow_cfs' = 'Transported.Flow..cfs.',
'treated_flow_cfs' = 'Treated.Flow..cfs.',
'injected_flow_cfs' = 'Injected.Flow..cfs.',
'reservoir_trend_cfs' = 'Reservoir.Trend..cfs.',)
#Make Date and Time match a consistant format with the Weather Data
sp2 <- as.data.frame(str_split_fixed(sp$date_time, " ", 3))%>%
rename(date = V1, time = V2, am_or_pm = V3)%>%
mutate(datetime_str = paste(date, time, am_or_pm),
datetime = as.POSIXct(strptime(datetime_str, format = "%m/%d/%y %I:%M %p")),
datetime_military = strftime(datetime, format = "%m/%d/%Y %H:%M")) %>%
select(datetime,datetime_military)
sp3 <-as.data.frame(str_split_fixed(sp2$datetime_military, " ", 2))%>%
rename(date = V1, time = V2)
sp4 <-as.data.frame(str_split_fixed(sp3$date, "/", 3))%>%
rename(CalendarMonth = V1,  CalendarDay = V2, CalendarYear = V3)
#Throw it all together
sp <- cbind(sp,sp2,sp3,sp4)%>%
mutate(reservoir_trend_cfs = as.numeric(reservoir_trend_cfs))%>%
select(-date_time)
#Get rid of temp dfs
remove(sp2,sp3,sp4)
glimpse(sd)
summary(sd)
ggplot(sd,aes(hourly_demand))+
geom_histogram()+
theme_minimal()
ggplot(sd,aes(hourly_demand))+
geom_histogram()+
theme_minimal()+
facet_wrap(~CalendarMonth)
sd <- sd%>%
mutate(season = ifelse(CalendarMonth %in% c('03','04','05'), 'Spring',
ifelse(CalendarMonth %in% c('06','07','08'), 'Summer',
ifelse(CalendarMonth %in% c('09','10','11'), 'Fall',
ifelse(CalendarMonth %in% c('12','01','02'), 'Winter','0')))))%>%
filter(season != '0')
sp <- sp%>%
mutate(season = ifelse(CalendarMonth %in% c('03','04','05'), 'Spring',
ifelse(CalendarMonth %in% c('06','07','08'), 'Summer',
ifelse(CalendarMonth %in% c('09','10','11'), 'Fall',
ifelse(CalendarMonth %in% c('12','01','02'), 'Winter','0')))))%>%
filter(season != '0')
wa <- wa%>%
mutate(season = ifelse(CalendarMonth %in% c('3','4','5'), 'Spring',
ifelse(CalendarMonth %in% c('6','7','8'), 'Summer',
ifelse(CalendarMonth %in% c('9','10','11'), 'Fall',
ifelse(CalendarMonth %in% c('12','1','2'), 'Winter','0')))))%>%
filter(season != '0')
ggplot(sd,aes(hourly_demand))+
geom_histogram()+
theme_minimal()+
facet_wrap(~season)
sd2 <- as.data.frame(str_split_fixed(sd$time,':',2))%>%
rename(Hour = V1, Min = V2)
sd <- cbind(sd,sd2)
sd%>%
group_by(Hour)%>%
summarise(mean(hourly_demand))%>%
rename(avg_demand = 'mean(hourly_demand)')%>%
ggplot(aes(Hour, avg_demand))+
geom_col()+
theme_minimal()
sd%>%
group_by(season,Hour)%>%
summarise(mean(hourly_demand))%>%
rename(avg_demand = 'mean(hourly_demand)')%>%
ggplot(aes(Hour, avg_demand))+
geom_col()+
theme_minimal()+
facet_wrap(~season)
sd%>%
group_by(season)%>%
summarise(mean(hourly_demand))%>%
rename(avg_demand = 'mean(hourly_demand)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sd%>%
group_by(CalendarMonth)%>%
summarise(mean(hourly_demand))%>%
rename(avg_demand = 'mean(hourly_demand)')%>%
ggplot(aes(CalendarMonth, avg_demand))+
geom_col()+
theme_minimal()
sd%>%
group_by(CalendarYear)%>%
summarise(sum(hourly_demand))%>%
rename(Sum_of_demand = 'sum(hourly_demand)')%>%
ggplot(aes(CalendarYear, Sum_of_demand))+
geom_col()+
theme_minimal()
glimpse(sp)
summary(sp)
sp%>%
group_by(season)%>%
summarise(mean(well_flow_cfs))%>%
rename(avg_demand = 'mean(well_flow_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(mean(purchased_flow_cfs))%>%
rename(avg_demand = 'mean(purchased_flow_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(mean(transported_flow_cfs))%>%
rename(avg_demand = 'mean(transported_flow_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(mean(treated_flow_cfs))%>%
rename(avg_demand = 'mean(treated_flow_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(mean(injected_flow_cfs))%>%
rename(avg_demand = 'mean(injected_flow_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(sum(reservoir_trend_cfs))%>%
rename(avg_demand = 'sum(reservoir_trend_cfs)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
sp%>%
group_by(season)%>%
summarise(sum(reservoir_trend_cfs))%>%
rename(sum_of_demand = 'sum(reservoir_trend_cfs)')%>%
ggplot(aes(season, sum_of_demand))+
geom_col()+
theme_minimal()
ggplot(sp,aes(reservoir_trend_cfs))+
geom_histogram()+
theme_minimal()
ggplot(sp,aes(injected_flow_cfs))+
geom_histogram()+
theme_minimal()
glimpse(wa)
summary(wa)
sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand))
sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand))%>%
select(CalendarMonth)
sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand),
CalendarMonth = CalendarMonth)
sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand),
CalendarMonth = CalendarMonth,
CalendarDay = CalendarDay,
CalendarYear = CalendarYear,
season = season)
sd1 <- sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand),
CalendarMonth = CalendarMonth,
CalendarDay = CalendarDay,
CalendarYear = CalendarYear,
season = season)%>%
rename(date = WeatherDate)
sd1 <- sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand),
CalendarMonth = CalendarMonth,
CalendarDay = CalendarDay,
CalendarYear = CalendarYear,
season = season)%>%
rename(WeatherDate = date)
#merge(wa,sd1,)
sd1 <- sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand),
CalendarMonth = CalendarMonth,
CalendarDay = CalendarDay,
CalendarYear = CalendarYear,
season = season)%>%
rename(WeatherDate = date)
merge(wa,sd1,by="WeatherDate")
sd1 <- sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand),
CalendarMonth = CalendarMonth,
CalendarDay = CalendarDay,
CalendarYear = CalendarYear,
season = season)%>%
rename(WeatherDate = date)
wa1 <- wa%>%
select(-CalendarYear,-CalendarMonth,-CalendarDay,-season)
merge(wa1,sd1,by="WeatherDate")
sd1 <- sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand),
CalendarMonth = CalendarMonth,
CalendarDay = CalendarDay,
CalendarYear = CalendarYear,
season = season)
wa1 <- wa%>%
select(-CalendarYear,-CalendarMonth,-CalendarDay,-season)%>%
rename(date = WeatherDate)
merge(wa1,sd1,by="date")
sd1 <- sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand),
CalendarMonth = CalendarMonth,
CalendarDay = CalendarDay,
CalendarYear = CalendarYear,
season = season)
wa1 <- wa%>%
select(-CalendarYear,-CalendarMonth,-CalendarDay,-season)%>%
rename(date = WeatherDate)
wd <- merge(wa1,sd1,by="date")
#Get rid of temp dfs
remove(sd1,wa1)
sd1 <- sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand),
CalendarMonth = CalendarMonth,
CalendarDay = CalendarDay,
CalendarYear = CalendarYear,
season = season)
wa1 <- wa%>%
select(-CalendarYear,-CalendarMonth,-CalendarDay,-season)%>%
rename(date = WeatherDate)
wd <- merge(wa1,sd1,by="date")
#Get rid of temp dfs
remove(sd1,sd2,wa1)
sd1 <- sd%>%
group_by(date)%>%
summarise(daily_demand = mean(hourly_demand),
CalendarMonth = CalendarMonth,
CalendarDay = CalendarDay,
CalendarYear = CalendarYear,
season = season)
wa1 <- wa%>%
select(-CalendarYear,-CalendarMonth,-CalendarDay,-season)%>%
rename(date = WeatherDate)
wd <- merge(wa1,sd1,by="date")
#Get rid of temp dfs
remove(sd1,sd2,wa1)
summary(wd)
wd%>%
group_by(SnowDepth)%>%
summarise(mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')%>%
ggplot(aes(season, avg_demand))+
geom_col()+
theme_minimal()
wd%>%
group_by(SnowDepth)%>%
summarise(mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')%>%
ggplot(aes(SnowDepth, avg_demand))+
geom_col()+
theme_minimal()
wd%>%
group_by(TemperatureMean)%>%
summarise(mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')%>%
ggplot(aes(TemperatureMean, avg_demand))+
geom_col()+
theme_minimal()
wd%>%
group_by(TemperatureMean)%>%
summarise(mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')%>%
ggplot(aes(TemperatureMean, avg_demand))+
geom_col()+
theme_minimal()
wd%>%
group_by(TemperatureMean)%>%
summarise(mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')%>%
ggplot(aes(TemperatureMean, avg_demand))+
geom_line()+
theme_minimal()
wd%>%
group_by(RainDays)%>%
summarise(mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
summarise(count_of_days = sum(RainDays),
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
summarise(count_of_days = count(nrows),
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
summarise(count_of_days = count(nrow),
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
summarise(count_of_days = count(wd$nrow),
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
summarise(count_of_days = nrow,
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
summarise(count_of_days = nrow(wd),
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
mutate(count_of_days = nrow(wd))
summarise(count_of_days,
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
mutate(count_of_days = nrow(wd))%>%
summarise(count_of_days,
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
mutate(count_of_days = nrow(wd))%>%
summarise(sum(count_of_days),
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
mutate(count_of_days = 1)%>%
summarise(sum(count_of_days),
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(RainDays)%>%
mutate(count_of_days = 1)%>%
summarise(count_of_days = sum(count_of_days),
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
group_by(SnowFall)%>%
mutate(count_of_days = 1)%>%
summarise(count_of_days = sum(count_of_days),
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
wd%>%
mutate(snow_day = ifelse(SnowFall>0,1,0))%>%
group_by(snow_day)%>%
mutate(count_of_days = 1)%>%
summarise(count_of_days = sum(count_of_days),
mean(daily_demand))%>%
rename(avg_demand = 'mean(daily_demand)')
